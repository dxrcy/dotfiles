#------------------------------------------------------------------------------#
#                        * Blazingly fast Tmux config *                        #
#------------------------------------------------------------------------------#

# Mouse for scrolling
set -g mouse on

# Remove unused keybinds
unbind-key d
unbind-key C-z

#-------------------------------------------------------------------------------
# Panes

# Switch to pane
bind j select-pane -D
bind k select-pane -U
bind h select-pane -L
bind l select-pane -R

# Resize pane
bind -r C-j resize-pane -D 10
bind -r C-k resize-pane -U 10
bind -r C-h resize-pane -L 10
bind -r C-l resize-pane -R 10

# Fullscreen pane
bind f setw -g aggressive-resize on \; resize-pane -Z

# Split pane
bind C-e split-window -h -c "#{pane_current_path}"
bind C-d split-window -v -c "#{pane_current_path}"

# Open pane in own window
bind u break-pane

#-------------------------------------------------------------------------------
# Windows

# Switch to last window
bind b last-window
bind C-b last-window

# Kill window
bind X confirm-before -p "kill-window? (y/n)" kill-window

#-------------------------------------------------------------------------------
# Options

# Toggle status bar, hide by default
bind t set-option -g status
set-option -g status off

# Start at index 1
set -g base-index 1
setw -g pane-base-index 1

# Decrease higher windows index, when window closed
set -g renumber-windows on

#-------------------------------------------------------------------------------
# Custom windows/popups

# Open lazygit, in fullscreen vertial pane
# If not in a git repo, display a message
bind g split-window -v -Z -c "#{pane_current_path}" \
    "if git rev-parse --is-inside-work-tree > /dev/null 2>&1; \
        then lazygit; \
        else tmux display 'not a git repo'; sleep 0.4; \
    fi"

# Open window with empty text file
bind o new-window -n "[notes]" \
    'cd ~/docs/notes && nvim "$(~/scripts/cmd/notename)"'

# Open popup with all visible URLs (naive regex)
bind U display-popup -w 50% -h 40% -E \
    "tmux capture-pane -J -p \
    | rg -o '(https?)://[^>\s\"'\\''\\]]*[^>\s.,;:!?)\"'\\''\\]]' \
    | fzf | xargs xdg-open"

bind space display-popup -w 50% -h 40% -E \
    "~/scripts/cmd/fzf-project | xargs tmux new-window -c"

